function launch(){chrome.tabs.query({active:!0,currentWindow:!0},(function(tabs){var tabPosition=tabs[0].index,tabID=tabs[0].id;chrome.tabs.sendMessage(tabs[0].id,{message:"Gimme the rendered DOM"},(function(response){if(response){var renderedObjURL=response.payload,renderedStorageKey="VRS|"+tabs[0].id,doctypeKey="VRSDOCTYPE|"+tabs[0].id,UAKey="VRSUA|"+tabs[0].id;chrome.storage.local.set({[renderedStorageKey]:renderedObjURL}),chrome.storage.local.set({[doctypeKey]:response.doctype}),chrome.storage.local.set({[UAKey]:response.userAgent}),chrome.tabs.create({url:"viewrenderedsource.html?tabID="+tabID,index:tabPosition+1})}}))}))}function removeStorage(tabId,changeInfo){var renderedDOMKey="VRS|"+tabId,doctypeKey="VRSDOCTYPE|"+tabId,UAKey="VRSUA|"+tabId;chrome.storage.local.get(renderedDOMKey,(function(result){chrome.storage.local.remove(renderedDOMKey),chrome.storage.local.remove(doctypeKey),chrome.storage.local.remove(UAKey)}))}chrome.browserAction.onClicked.addListener((function(tab){launch()})),chrome.contextMenus.create({title:"View Rendered Source (Ctrl+Shift+U)",contexts:["page"],onclick:launch}),chrome.tabs.onRemoved.addListener((function(tabId,changeInfo,tab){removeStorage(tabId,changeInfo)})),chrome.tabs.onUpdated.addListener((function(tabId,changeInfo,tab){"loading"==changeInfo.status&&removeStorage(tabId,changeInfo)})),chrome.webRequest.onBeforeSendHeaders.addListener((function(details){for(var overrideUA=!1,t=0,i=details.requestHeaders.length;t<i;++t){if("X-VRS-Override-UA"===details.requestHeaders[t].name)switch(overrideUA=!0,details.requestHeaders[t].value){case"Chrome-Mobile":var newUA="Mozilla/5.0 (iPhone; CPU iPhone OS 11_0 like Mac OS X) AppleWebKit/604.1.38 (KHTML, like Gecko) Version/11.0 Mobile/15A372 Safari/604.1";break;case"Google-Desktop":var newUA="Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)";break;case"Google-Mobile":var newUA="Mozilla/5.0 (Linux; Android 6.0.1; Nexus 5X Build/MMB29P) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.96 Mobile Safari/537.36 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)"}overrideUA&&"User-Agent"===details.requestHeaders[t].name&&(details.requestHeaders[t].value=newUA)}return{requestHeaders:details.requestHeaders}}),{urls:["<all_urls>"]},["blocking","requestHeaders"]);
//# sourceMappingURL=background.min.js.map